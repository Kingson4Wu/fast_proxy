"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[340],{209:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>a,contentTitle:()=>s,default:()=>p,frontMatter:()=>l,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"deployment","title":"Deployment & Operations","description":"This guide covers deployment strategies and operational considerations for running FastProxy in production environments.","source":"@site/docs/deployment.mdx","sourceDirName":".","slug":"/deployment","permalink":"/fast_proxy/zh/docs/deployment","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/deployment.mdx","tags":[],"version":"current","sidebarPosition":6,"frontMatter":{"sidebar_position":6},"sidebar":"tutorialSidebar","previous":{"title":"Performance & Optimization","permalink":"/fast_proxy/zh/docs/performance"}}');var o=i(4848),t=i(8453);const l={sidebar_position:6},s="Deployment & Operations",a={},c=[{value:"Building and Deploying",id:"building-and-deploying",level:2},{value:"Build from Source",id:"build-from-source",level:3},{value:"Docker Deployment",id:"docker-deployment",level:3},{value:"Binary Deployment",id:"binary-deployment",level:3},{value:"Deployment Patterns",id:"deployment-patterns",level:2},{value:"Embedded Mode",id:"embedded-mode",level:3},{value:"Sidecar Mode",id:"sidecar-mode",level:3},{value:"Dedicated Proxy Cluster",id:"dedicated-proxy-cluster",level:3},{value:"Standalone Mode",id:"standalone-mode",level:3},{value:"Configuration Management",id:"configuration-management",level:2},{value:"Static Configuration (YAML)",id:"static-configuration-yaml",level:3},{value:"Dynamic Configuration (Apollo)",id:"dynamic-configuration-apollo",level:3},{value:"Service Configuration",id:"service-configuration",level:2},{value:"Per-Service Settings",id:"per-service-settings",level:3},{value:"Rate Limiting",id:"rate-limiting",level:3},{value:"Operational Procedures",id:"operational-procedures",level:2},{value:"Startup Sequence",id:"startup-sequence",level:3},{value:"Health Monitoring",id:"health-monitoring",level:3},{value:"Log Analysis",id:"log-analysis",level:3},{value:"Security Considerations",id:"security-considerations",level:2},{value:"Key Management",id:"key-management",level:3},{value:"Network Security",id:"network-security",level:3},{value:"Configuration Security",id:"configuration-security",level:3},{value:"Scaling Strategies",id:"scaling-strategies",level:2},{value:"Horizontal Scaling",id:"horizontal-scaling",level:3},{value:"Vertical Scaling",id:"vertical-scaling",level:3},{value:"Environment-Specific Configurations",id:"environment-specific-configurations",level:2},{value:"Development",id:"development",level:3},{value:"Production",id:"production",level:3},{value:"Testing",id:"testing",level:3}];function d(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"deployment--operations",children:"Deployment & Operations"})}),"\n",(0,o.jsx)(n.p,{children:"This guide covers deployment strategies and operational considerations for running FastProxy in production environments."}),"\n",(0,o.jsx)(n.h2,{id:"building-and-deploying",children:"Building and Deploying"}),"\n",(0,o.jsx)(n.h3,{id:"build-from-source",children:"Build from Source"}),"\n",(0,o.jsx)(n.p,{children:"FastProxy provides Makefile targets to build the components:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# Download dependencies and build all components\nmake\n\n# This creates the executables:\n# - center\n# - server\n# - in-proxy\n# - out-proxy\n# - client\n"})}),"\n",(0,o.jsx)(n.h3,{id:"docker-deployment",children:"Docker Deployment"}),"\n",(0,o.jsx)(n.p,{children:"Containerize FastProxy components for consistent deployments:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-dockerfile",children:'# Dockerfile for in-proxy\nFROM golang:1.21-alpine AS builder\n\nWORKDIR /app\nCOPY . .\nRUN go mod download\nRUN go build -o in-proxy ./examples/inproxy/main.go\n\nFROM alpine:latest\nRUN apk --no-cache add ca-certificates\nWORKDIR /root/\nCOPY --from=builder /app/in-proxy .\nCOPY --from=builder /app/examples/inproxy/config.yaml ./config.yaml\n\nEXPOSE 8033\nCMD ["./in-proxy"]\n'})}),"\n",(0,o.jsx)(n.h3,{id:"binary-deployment",children:"Binary Deployment"}),"\n",(0,o.jsx)(n.p,{children:"The built binaries can be deployed directly:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# Deploy in-proxy\nscp in-proxy server:/opt/fastproxy/\nscp config.yaml server:/opt/fastproxy/\n\n# Start the service\n/opt/fastproxy/in-proxy\n"})}),"\n",(0,o.jsx)(n.h2,{id:"deployment-patterns",children:"Deployment Patterns"}),"\n",(0,o.jsx)(n.h3,{id:"embedded-mode",children:"Embedded Mode"}),"\n",(0,o.jsx)(n.p,{children:"Integrate FastProxy directly into your Go application:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-go",children:'package main\n\nimport (\n    "github.com/Kingson4Wu/fast_proxy/inproxy"\n    "github.com/Kingson4Wu/fast_proxy/inproxy/inconfig"\n)\n\nfunc main() {\n    // Load configuration from YAML\n    config := inconfig.LoadYamlConfig(configBytes)\n\n    // Start the proxy server\n    inproxy.NewServer(config)\n}\n'})}),"\n",(0,o.jsx)(n.h3,{id:"sidecar-mode",children:"Sidecar Mode"}),"\n",(0,o.jsx)(n.p,{children:"Deploy FastProxy as a separate process alongside your application:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502   Application   \u2502\u25c4\u2500\u2500\u25ba\u2502   FastProxy     \u2502\n\u2502                 \u2502    \u2502   (sidecar)     \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,o.jsx)(n.p,{children:"Application communicates with FastProxy over localhost, and FastProxy handles all external communication with encryption/signing."}),"\n",(0,o.jsx)(n.h3,{id:"dedicated-proxy-cluster",children:"Dedicated Proxy Cluster"}),"\n",(0,o.jsx)(n.p,{children:"Deploy FastProxy components separately:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"in-proxy"})," instances handle incoming traffic"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"out-proxy"})," instances handle outgoing traffic"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"center"})," manages service discovery coordination"]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"standalone-mode",children:"Standalone Mode"}),"\n",(0,o.jsx)(n.p,{children:"Run each component as a separate service:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# Start center component (if using service discovery)\n./center &\n\n# Start out-proxy component\n./out-proxy &\n\n# Start in-proxy component\n./in-proxy &\n"})}),"\n",(0,o.jsx)(n.h2,{id:"configuration-management",children:"Configuration Management"}),"\n",(0,o.jsx)(n.h3,{id:"static-configuration-yaml",children:"Static Configuration (YAML)"}),"\n",(0,o.jsx)(n.p,{children:"Default configuration method using YAML files:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:"proxy:\n  forwardAddress: http://127.0.0.1:9833/inProxy\n\napplication:\n  name: in_proxy\n  port: 8033\n  contextPath: /inProxy\n\nrpc:\n  serviceHeaderName: C_ServiceName\n\nserviceConfig:\n  song_service:\n    encryptKeyName: encrypt.key.room.v2\n    signKeyName: sign.key.room.v1\n    encryptEnable: true\n    signEnable: true\n    compressEnable: true\n\nsignKeyConfig:\n  sign.key.room.v1: abcd\n  sign.key.room.v2: abcd\n\nencryptKeyConfig:\n  encrypt.key.room.v1: ABCDABCDABCDABCDW\n  encrypt.key.room.v2: ABCDABCDABCDABCD\n\nserviceCallTypeConfig:\n  song_service:\n    /token_service/api/service:\n      callType: 1\n      qps: 10\n\nhttpClient:\n  MaxIdleConns: 5000\n  MaxIdleConnsPerHost: 3000\n\nfastHttp:\n  enable: true\n"})}),"\n",(0,o.jsx)(n.h3,{id:"dynamic-configuration-apollo",children:"Dynamic Configuration (Apollo)"}),"\n",(0,o.jsx)(n.p,{children:"For dynamic configuration updates, FastProxy supports Apollo Configuration Center:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-go",children:'import "github.com/Kingson4Wu/fast_proxy/common/apollo"\n\n// Initialize Apollo configuration\napolloConfig := &apollo.Config{\n    ApolloAddr:    "http://your-apollo-server:8080",\n    AppID:         "fastproxy",\n    Cluster:       "default",\n    NamespaceName: "application",\n}\n\napollo.InitApolloConfig(apolloConfig)\n'})}),"\n",(0,o.jsx)(n.p,{children:"Configuration parameters for Apollo:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:'apollo:\n  apolloAddr: "http://your-apollo-server:8080"\n  appId: "fastproxy"\n  cluster: "default"\n  namespaceName: "application"\n  refreshInterval: "5s"  # How often to check for updates\n'})}),"\n",(0,o.jsx)(n.h2,{id:"service-configuration",children:"Service Configuration"}),"\n",(0,o.jsx)(n.h3,{id:"per-service-settings",children:"Per-Service Settings"}),"\n",(0,o.jsx)(n.p,{children:"Configure different security policies per service:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:"serviceConfig:\n  # Highly sensitive service with full security\n  critical_api:\n    encryptKeyName: critical.encrypt.key\n    signKeyName: critical.sign.key\n    encryptEnable: true\n    signEnable: true\n    compressEnable: true\n\n  # Public service with integrity but no encryption\n  public_api:\n    encryptKeyName: public.encrypt.key\n    signKeyName: public.sign.key\n    encryptEnable: false  # No encryption needed\n    signEnable: true      # But still sign for integrity\n    compressEnable: true\n"})}),"\n",(0,o.jsx)(n.h3,{id:"rate-limiting",children:"Rate Limiting"}),"\n",(0,o.jsx)(n.p,{children:"Configure rate limits per service and endpoint:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:"serviceCallTypeConfig:\n  service_name:\n    /api/endpoint:\n      callType: 1     # 1: direct call, 2: forwarded call\n      qps: 1000      # Queries per second limit\n      timeout: 5000  # Request timeout in milliseconds\n      limit: 2000    # Connection limit\n"})}),"\n",(0,o.jsx)(n.h2,{id:"operational-procedures",children:"Operational Procedures"}),"\n",(0,o.jsx)(n.h3,{id:"startup-sequence",children:"Startup Sequence"}),"\n",(0,o.jsx)(n.p,{children:"For a complete FastProxy deployment, follow this startup order:"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["If using service discovery: Start ",(0,o.jsx)(n.code,{children:"center"})," component first"]}),"\n",(0,o.jsxs)(n.li,{children:["Start ",(0,o.jsx)(n.code,{children:"out-proxy"})," components"]}),"\n",(0,o.jsxs)(n.li,{children:["Start ",(0,o.jsx)(n.code,{children:"in-proxy"})," components"]}),"\n",(0,o.jsx)(n.li,{children:"Start your upstream services"}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"health-monitoring",children:"Health Monitoring"}),"\n",(0,o.jsx)(n.p,{children:"Monitor these key metrics:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Response times for different services"}),"\n",(0,o.jsx)(n.li,{children:"Error rates and failure patterns"}),"\n",(0,o.jsx)(n.li,{children:"Resource utilization (CPU, memory, connections)"}),"\n",(0,o.jsx)(n.li,{children:"Successful encryption/decryption operations"}),"\n",(0,o.jsx)(n.li,{children:"Proper signing/verification operations"}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"log-analysis",children:"Log Analysis"}),"\n",(0,o.jsx)(n.p,{children:"FastProxy uses structured logging via Zap. Monitor logs for:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Successful request forwarding"}),"\n",(0,o.jsx)(n.li,{children:"Encryption/decryption success/failure"}),"\n",(0,o.jsx)(n.li,{children:"Signing/verification success/failure"}),"\n",(0,o.jsx)(n.li,{children:"Service discovery registration status"}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"security-considerations",children:"Security Considerations"}),"\n",(0,o.jsx)(n.h3,{id:"key-management",children:"Key Management"}),"\n",(0,o.jsx)(n.p,{children:"Handle encryption and signing keys securely:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Store keys in secure locations, not in source code"}),"\n",(0,o.jsx)(n.li,{children:"Rotate keys regularly to maintain security"}),"\n",(0,o.jsx)(n.li,{children:"Use different keys for different services/environments"}),"\n",(0,o.jsx)(n.li,{children:"Implement proper access controls for key files and systems"}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"network-security",children:"Network Security"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Use encrypted connections between proxy components"}),"\n",(0,o.jsx)(n.li,{children:"Implement proper firewall rules"}),"\n",(0,o.jsx)(n.li,{children:"Monitor for unusual traffic patterns"}),"\n",(0,o.jsx)(n.li,{children:"Set appropriate timeouts to prevent resource exhaustion"}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"configuration-security",children:"Configuration Security"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Restrict access to configuration files"}),"\n",(0,o.jsx)(n.li,{children:"Use environment-specific configurations"}),"\n",(0,o.jsx)(n.li,{children:"Validate configuration values before applying"}),"\n",(0,o.jsx)(n.li,{children:"Audit configuration changes"}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"scaling-strategies",children:"Scaling Strategies"}),"\n",(0,o.jsx)(n.h3,{id:"horizontal-scaling",children:"Horizontal Scaling"}),"\n",(0,o.jsx)(n.p,{children:"Scale by deploying multiple proxy instances:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Deploy multiple ",(0,o.jsx)(n.code,{children:"in-proxy"})," instances behind a load balancer"]}),"\n",(0,o.jsx)(n.li,{children:"Share configurations via Apollo Configuration Center or shared storage"}),"\n",(0,o.jsxs)(n.li,{children:["Use the ",(0,o.jsx)(n.code,{children:"center"})," component for service discovery coordination"]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"vertical-scaling",children:"Vertical Scaling"}),"\n",(0,o.jsx)(n.p,{children:"Increase resources on existing machines:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"More CPU for encryption/decryption operations"}),"\n",(0,o.jsx)(n.li,{children:"More memory for connection pooling and buffer management"}),"\n",(0,o.jsx)(n.li,{children:"Better network interfaces for improved throughput"}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"environment-specific-configurations",children:"Environment-Specific Configurations"}),"\n",(0,o.jsx)(n.h3,{id:"development",children:"Development"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:'logging:\n  level: "debug"  # More verbose logging in development\nfastHttp:\n  enable: false   # Can disable FastHTTP for easier debugging initially\n'})}),"\n",(0,o.jsx)(n.h3,{id:"production",children:"Production"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:'logging:\n  level: "info"   # Less verbose logging for production\nfastHttp:\n  enable: true    # Enable FastHTTP for better performance\nhttpClient:\n  MaxIdleConns: 5000           # Higher connection limits\n  MaxIdleConnsPerHost: 3000    # Higher per-host limits\n  IdleConnTimeout: "90s"       # Longer connection persistence\n'})}),"\n",(0,o.jsx)(n.h3,{id:"testing",children:"Testing"}),"\n",(0,o.jsx)(n.p,{children:"Use different configuration sets for testing to validate performance and functionality under various load conditions."})]})}function p(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>l,x:()=>s});var r=i(6540);const o={},t=r.createContext(o);function l(e){const n=r.useContext(t);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:l(e.components),r.createElement(t.Provider,{value:n},e.children)}}}]);